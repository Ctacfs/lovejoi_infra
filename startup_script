gcloud beta compute --project=infra-271411 instances create reddit-app --zone=europe-west1-b --machine-type=f1-micro --subnet=default --network-tier=PREMIUM --metadata=startup-script=\#\!/bin/bash$'\n'sudo\ apt\ update$'\n'sudo\ apt\ install\ -y\ ruby-full\ ruby-bundler\ build-essential$'\n'\#Add\ key\ and\ repository\ for\ MongoDB$'\n'$'\n'sudo\ apt-key\ adv\ --keyserver\ hkp://keyserver.ubuntu.com:80\ --recv-keys\ 0xd68fa50fea312927$'\n'sudo\ bash\ -c\ \'echo\ \"deb\ http://repo.mongodb.org/apt/ubuntu\ xenial/mongodb-org/3.2\ multiverse\"\ \>\ /etc/apt/sources.list.d/mongodb-org-3.2.list\'$'\n'$'\n'\#Update\ packages\ list\ and\ install\ MongoDB$'\n'$'\n'sudo\ apt\ update$'\n'sudo\ apt\ install\ -y\ mongodb-org$'\n'$'\n'\#Run\ MongoDB$'\n'sudo\ systemctl\ start\ mongod$'\n'$'\n'\#Add\ Autorun$'\n'sudo\ systemctl\ enable\ mongod$'\n'$'\n'\#Clone\ App\ from\ Git$'\n'git\ clone\ -b\ monolith\ https://github.com/express42/reddit.git$'\n'$'\n'\#Change\ directory$'\n'cd\ reddit$'\n'$'\n'\#INstall\ application$'\n'bundle\ install$'\n'$'\n'\#Start\ Server$'\n'puma\ -d --maintenance-policy=MIGRATE --service-account=192443272709-compute@developer.gserviceaccount.com --scopes=https://www.googleapis.com/auth/devstorage.read_only,https://www.googleapis.com/auth/logging.write,https://www.googleapis.com/auth/monitoring.write,https://www.googleapis.com/auth/servicecontrol,https://www.googleapis.com/auth/service.management.readonly,https://www.googleapis.com/auth/trace.append --tags=http-server,https-server --image=ubuntu-1604-xenial-v20200317 --image-project=ubuntu-os-cloud --boot-disk-size=10GB --boot-disk-type=pd-standard --boot-disk-device-name=reddit-app --no-shielded-secure-boot --shielded-vtpm --shielded-integrity-monitoring --reservation-affinity=any
